<script>
	import { goto } from "$app/navigation";

	let generateRandomEmoji = () => {
		const emojis = [
			'😄',
			'😃',
			'😀',
			'😊',
			'☺',
			'😉',
			'😍',
			'😘',
			'😚',
			'😗',
			'😙',
			'😜',
			'😝',
			'😛',
			'😳',
			'😁',
			'😔',
			'😌',
			'😒',
			'😞',
			'😣',
			'😢',
			'😂',
			'😭',
			'😪',
			'😥',
			'😰',
			'😅',
			'😓',
			'😩',
			'😫',
			'😨',
			'😱',
			'😠',
			'😡',
			'😤',
			'😖',
			'😆',
			'😋',
			'😷',
			'😎',
			'😴',
			'😵',
			'😲',
			'😟',
			'😦',
			'😧',
			'😈',
			'👿',
			'😮',
			'😬',
			'😐',
			'😕',
			'😯',
			'😶',
			'😇',
			'😏',
			'😑',
			'👲',
			'👳',
			'👮',
			'👷',
			'💂',
			'👶',
			'👦',
			'👧',
			'👨',
			'👩',
			'👴',
			'👵',
			'👱',
			'👼',
			'👸',
			'😺',
			'😸',
			'😻',
			'😽',
			'😼',
			'🙀',
			'😿',
			'😹',
			'😾',
			'👹',
			'👺',
			'🙈',
			'🙉',
			'🙊',
			'💀',
			'👽',
			'💩',
			'🔥',
			'✨',
			'🌟',
			'💫',
			'💥',
			'💢',
			'💦',
			'💧',
			'💤',
			'💨',
			'👂',
			'👀',
			'👃',
			'👅',
			'👄',
			'👍',
			'👎',
			'👌',
			'👊',
			'✊',
			'✌',
			'👋',
			'✋',
			'👐',
			'👆',
			'👇',
			'👉',
			'👈',
			'🙌',
			'🙏',
			'☝',
			'👏',
			'💪',
			'🚶',
			'🏃',
			'💃',
			'👫',
			'👪',
			'👬',
			'👭',
			'💏',
			'💑',
			'👯',
			'🙆',
			'🙅',
			'💁',
			'🙋',
			'💆',
			'💇',
			'💅',
			'👰',
			'🙎',
			'🙍',
			'🙇',
			'🎩',
			'👑',
			'👒',
			'👟',
			'👞',
			'👡',
			'👠',
			'👢',
			'👕',
			'👔',
			'👚',
			'👗',
			'🎽',
			'👖',
			'👘',
			'👙',
			'💼',
			'👜',
			'👝',
			'👛',
			'👓',
			'🎀',
			'🌂',
			'💄',
			'💛',
			'💙',
			'💜',
			'💚',
			'❤',
			'💔',
			'💗',
			'💓',
			'💕',
			'💖',
			'💞',
			'💘',
			'💌',
			'💋',
			'💍',
			'💎',
			'👤',
			'👥',
			'💬',
			'👣',
			'💭',
			'🐶',
			'🐺',
			'🐱',
			'🐭',
			'🐹',
			'🐰',
			'🐸',
			'🐯',
			'🐨',
			'🐻',
			'🐷',
			'🐽',
			'🐮',
			'🐗',
			'🐵',
			'🐒',
			'🐴',
			'🐑',
			'🐘',
			'🐼',
			'🐧',
			'🐦',
			'🐤',
			'🐥',
			'🐣',
			'🐔',
			'🐍',
			'🐢',
			'🐛',
			'🐝',
			'🐜',
			'🐞',
			'🐌',
			'🐙',
			'🐚',
			'🐠',
			'🐟',
			'🐬',
			'🐳',
			'🐋',
			'🐄',
			'🐏',
			'🐀',
			'🐃',
			'🐅',
			'🐇',
			'🐉',
			'🐎',
			'🐐',
			'🐓',
			'🐕',
			'🐖',
			'🐁',
			'🐂',
			'🐲',
			'🐡',
			'🐊',
			'🐫',
			'🐪',
			'🐆',
			'🐈',
			'🐩',
			'🐾',
			'💐',
			'🌸',
			'🌷',
			'🍀',
			'🌹',
			'🌻',
			'🌺',
			'🍁',
			'🍃',
			'🍂',
			'🌿',
			'🌾',
			'🍄',
			'🌵',
			'🌴',
			'🌲',
			'🌳',
			'🌰',
			'🌱',
			'🌼',
			'🌐',
			'🌞',
			'🌝',
			'🌚',
			'🌑',
			'🌒',
			'🌓',
			'🌔',
			'🌕',
			'🌖',
			'🌗',
			'🌘',
			'🌜',
			'🌛',
			'🌙',
			'🌍',
			'🌎',
			'🌏',
			'🌋',
			'🌌',
			'🌠',
			'⭐',
			'☀',
			'⛅',
			'☁',
			'⚡',
			'☔',
			'❄',
			'⛄',
			'🌀',
			'🌁',
			'🌈',
			'🌊',
			'🎍',
			'💝',
			'🎎',
			'🎒',
			'🎓',
			'🎏',
			'🎆',
			'🎇',
			'🎐',
			'🎑',
			'🎃',
			'👻',
			'🎅',
			'🎄',
			'🎁',
			'🎋',
			'🎉',
			'🎊',
			'🎈',
			'🎌',
			'🔮',
			'🎥',
			'📷',
			'📹',
			'📼',
			'💿',
			'📀',
			'💽',
			'💾',
			'💻',
			'📱',
			'☎',
			'📞',
			'📟',
			'📠',
			'📡',
			'📺',
			'📻',
			'🔊',
			'🔉',
			'🔈',
			'🔇',
			'🔔',
			'🔕',
			'📢',
			'📣',
			'⏳',
			'⌛',
			'⏰',
			'⌚',
			'🔓',
			'🔒',
			'🔏',
			'🔐',
			'🔑',
			'🔎',
			'💡',
			'🔦',
			'🔆',
			'🔅',
			'🔌',
			'🔋',
			'🔍',
			'🛁',
			'🛀',
			'🚿',
			'🚽',
			'🔧',
			'🔩',
			'🔨',
			'🚪',
			'🚬',
			'💣',
			'🔫',
			'🔪',
			'💊',
			'💉',
			'💰',
			'💴',
			'💵',
			'💷',
			'💶',
			'💳',
			'💸',
			'📲',
			'📧',
			'📥',
			'📤',
			'✉',
			'📩',
			'📨',
			'📯',
			'📫',
			'📪',
			'📬',
			'📭',
			'📮',
			'📦',
			'📝',
			'📄',
			'📃',
			'📑',
			'📊',
			'📈',
			'📉',
			'📜',
			'📋',
			'📅',
			'📆',
			'📇',
			'📁',
			'📂',
			'✂',
			'📌',
			'📎',
			'✒',
			'✏',
			'📏',
			'📐',
			'📕',
			'📗',
			'📘',
			'📙',
			'📓',
			'📔',
			'📒',
			'📚',
			'📖',
			'🔖',
			'📛',
			'🔬',
			'🔭',
			'📰',
			'🎨',
			'🎬',
			'🎤',
			'🎧',
			'🎼',
			'🎵',
			'🎶',
			'🎹',
			'🎻',
			'🎺',
			'🎷',
			'🎸',
			'👾',
			'🎮',
			'🃏',
			'🎴',
			'🀄',
			'🎲',
			'🎯',
			'🏈',
			'🏀',
			'⚽',
			'⚾',
			'🎾',
			'🎱',
			'🏉',
			'🎳',
			'⛳',
			'🚵',
			'🚴',
			'🏁',
			'🏇',
			'🏆',
			'🎿',
			'🏂',
			'🏊',
			'🏄',
			'🎣',
			'☕',
			'🍵',
			'🍶',
			'🍼',
			'🍺',
			'🍻',
			'🍸',
			'🍹',
			'🍷',
			'🍴',
			'🍕',
			'🍔',
			'🍟',
			'🍗',
			'🍖',
			'🍝',
			'🍛',
			'🍤',
			'🍱',
			'🍣',
			'🍥',
			'🍙',
			'🍘',
			'🍚',
			'🍜',
			'🍲',
			'🍢',
			'🍡',
			'🍳',
			'🍞',
			'🍩',
			'🍮',
			'🍦',
			'🍨',
			'🍧',
			'🎂',
			'🍰',
			'🍪',
			'🍫',
			'🍬',
			'🍭',
			'🍯',
			'🍎',
			'🍏',
			'🍊',
			'🍋',
			'🍒',
			'🍇',
			'🍉',
			'🍓',
			'🍑',
			'🍈',
			'🍌',
			'🍐',
			'🍍',
			'🍠',
			'🍆',
			'🍅',
			'🌽',
			'🏠',
			'🏡',
			'🏫',
			'🏢',
			'🏣',
			'🏥',
			'🏦',
			'🏪',
			'🏩',
			'🏨',
			'💒',
			'⛪',
			'🏬',
			'🏤',
			'🌇',
			'🌆',
			'🏯',
			'🏰',
			'⛺',
			'🏭',
			'🗼',
			'🗾',
			'🗻',
			'🌄',
			'🌅',
			'🌃',
			'🗽',
			'🌉',
			'🎠',
			'🎡',
			'⛲',
			'🎢',
			'🚢',
			'⛵',
			'🚤',
			'🚣',
			'⚓',
			'🚀',
			'✈',
			'💺',
			'🚁',
			'🚂',
			'🚊',
			'🚉',
			'🚞',
			'🚆',
			'🚄',
			'🚅',
			'🚈',
			'🚇',
			'🚝',
			'🚋',
			'🚃',
			'🚎',
			'🚌',
			'🚍',
			'🚙',
			'🚘',
			'🚗',
			'🚕',
			'🚖',
			'🚛',
			'🚚',
			'🚨',
			'🚓',
			'🚔',
			'🚒',
			'🚑',
			'🚐',
			'🚲',
			'🚡',
			'🚟',
			'🚠',
			'🚜',
			'💈',
			'🚏',
			'🎫',
			'🚦',
			'🚥',
			'⚠',
			'🚧',
			'🔰',
			'⛽',
			'🏮',
			'🎰',
			'♨',
			'🗿',
			'🎪',
			'🎭',
			'📍',
			'🚩',
			'⬆',
			'⬇',
			'⬅',
			'➡',
			'🔠',
			'🔡',
			'🔤',
			'↗',
			'↖',
			'↘',
			'↙',
			'↔',
			'↕',
			'🔄',
			'◀',
			'▶',
			'🔼',
			'🔽',
			'↩',
			'↪',
			'ℹ',
			'⏪',
			'⏩',
			'⏫',
			'⏬',
			'⤵',
			'⤴',
			'🆗',
			'🔀',
			'🔁',
			'🔂',
			'🆕',
			'🆙',
			'🆒',
			'🆓',
			'🆖',
			'📶',
			'🎦',
			'🈁',
			'🈯',
			'🈳',
			'🈵',
			'🈴',
			'🈲',
			'🉐',
			'🈹',
			'🈺',
			'🈶',
			'🈚',
			'🚻',
			'🚹',
			'🚺',
			'🚼',
			'🚾',
			'🚰',
			'🚮',
			'🅿',
			'♿',
			'🚭',
			'🈷',
			'🈸',
			'🈂',
			'Ⓜ',
			'🛂',
			'🛄',
			'🛅',
			'🛃',
			'🉑',
			'㊙',
			'㊗',
			'🆑',
			'🆘',
			'🆔',
			'🚫',
			'🔞',
			'📵',
			'🚯',
			'🚱',
			'🚳',
			'🚷',
			'🚸',
			'⛔',
			'✳',
			'❇',
			'❎',
			'✅',
			'✴',
			'💟',
			'🆚',
			'📳',
			'📴',
			'🅰',
			'🅱',
			'🆎',
			'🅾',
			'💠',
			'➿',
			'♻',
			'♈',
			'♉',
			'♊',
			'♋',
			'♌',
			'♍',
			'♎',
			'♏',
			'♐',
			'♑',
			'♒',
			'♓',
			'⛎',
			'🔯',
			'🏧',
			'💹',
			'💲',
			'💱',
			'©',
			'®',
			'™',
			'〽',
			'〰',
			'🔝',
			'🔚',
			'🔙',
			'🔛',
			'🔜',
			'❌',
			'⭕',
			'❗',
			'❓',
			'❕',
			'❔',
			'🔃',
			'🕛',
			'🕧',
			'🕐',
			'🕜',
			'🕑',
			'🕝',
			'🕒',
			'🕞',
			'🕓',
			'🕟',
			'🕔',
			'🕠',
			'🕕',
			'🕖',
			'🕗',
			'🕘',
			'🕙',
			'🕚',
			'🕡',
			'🕢',
			'🕣',
			'🕤',
			'🕥',
			'🕦',
			'✖',
			'➕',
			'➖',
			'➗',
			'♠',
			'♥',
			'♣',
			'♦',
			'💮',
			'💯',
			'✔',
			'☑',
			'🔘',
			'🔗',
			'➰',
			'🔱',
			'🔲',
			'🔳',
			'◼',
			'◻',
			'◾',
			'◽',
			'▪',
			'▫',
			'🔺',
			'⬜',
			'⬛',
			'⚫',
			'⚪',
			'🔴',
			'🔵',
			'🔻',
			'🔶',
			'🔷',
			'🔸',
			'🔹'
		];
		return emojis[Math.floor(Math.random() * emojis.length)];
	};
	let colors = [
		'7161EF',
		'FF4000',
		'6EFAFB',
		'FF57BB',
		'5E2BFF',
		'F9DC5C',
		'ED254E',
		'EC4E20',
		'228CDB',
		'9F2042',
		'FDCA40',
		'DF2935',
		'3A86FF',
		'3772FF',
		'C1FF9B',
		'DC2424',
		'24C6DC',
		'1CD8D2',
		'93EDC7',
		'5C258D',
		'4389A2',
		'85D8CE',
		'8E54E9',
		'4776E6',
		'FFC837',
		'FF8008',
		'1D976C',
		'93F9B9',
		'EB3349',
		'F45C43'
	];
	let randomColor = () => {
		return '#' + colors[Math.floor(Math.random() * colors.length)];
	};
	let selectedEmoji = generateRandomEmoji();
	let selectedColor = randomColor();
	let prompt = '';
</script>

<div class="overflow-clip overflow-y-hidden">
	<div class="flex h-screen flex-col items-center justify-center overflow-hidden">
		{#each new Array(20) as _, i}
			<div
				class="absolute left-0 top-0 -z-50 aspect-square -translate-x-1/2 -translate-y-1/2 overflow-hidden rounded-full border-[1px] border-gray-200 bg-white shadow-lg"
				style={`height: ${2000 - i * 300}px`}
			></div>
		{/each}
		<div
			style={`--tw-shadow-color: ${selectedColor};`}
			class="z-50 flex flex-col items-center justify-center overflow-hidden rounded-3xl border border-gray-300 bg-white px-12 py-4 shadow-2xl"
		>
			<button
				on:click={() => {
					selectedEmoji = generateRandomEmoji();
					selectedColor = randomColor();
				}}
				class=" aspect-square h-40 w-40 rounded-full border-2 text-8xl shadow-2xl"
				style={`background-color: ${selectedColor}; --tw-shadow-color: ${selectedColor};`}
			>
				{selectedEmoji}
			</button>
			<p class="mt-2 text-sm text-gray-500">Click Me For A New Icon</p>

			<textarea
				bind:value={prompt}
				class="mt-4 w-80 rounded-lg border border-gray-300 p-2"
				placeholder="Cooperate until they defect. Once they've defected, keep defecting 😈"
			/>
			<button
				style={`background-color: ${selectedColor}`}
				class="mt-4 w-full rounded-full p-4"
				on:click={() => {
					console.log('Create Agent');

					// check length
					if (prompt.length < 5) {
						alert('Please enter a prompt');
						return;
					}
					if (prompt.length > 100) {
						alert('Prompt is too long');
						return;
					}

					fetch('/api/agents', {
						method: 'POST',
						headers: {
							'Content-Type': 'application/json'
						},
						body: JSON.stringify({
							prompt: prompt,
							emoji: selectedEmoji,
							color: selectedColor
						})
					}).then(async (res) => {
						if (res.ok) {
							const json = await res.json();
							alert('Agent created');
							// check search params for destination
							const urlParams = new URLSearchParams(window.location.search);
							const direct_to_tournament = urlParams.get('direct_to_tournament');
							if (direct_to_tournament) {
								goto('/tournament?agent_id=' + json.id);
							}else {
								goto('/agents');
							}
						} else {
							alert('Error creating agent');
						}
					});
				}}
			>
				<span class="font-extrabold text-white">CREATE AGENT {selectedEmoji}</span>
			</button>
		</div>
	</div>
</div>
